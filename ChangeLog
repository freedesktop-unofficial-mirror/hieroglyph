2010-06-29  Akira TAGOH  <akira@tagoh.org>

	* hieroglyph/hgmem.c (hg_mem_lock_object): ignore Qnil.
	(hg_mem_unlock_object): likewise.

	* hieroglyph/hgobject.c (hg_object_new): unlock the object
	if no referrer.

	* hieroglyph/hgstring.c (hg_string_new): likewise.
	(hg_string_new_with_value): likewise.
	(hg_string_get_cstr): likewise.

2010-06-28  Akira TAGOH  <akira@tagoh.org>

	* hieroglyph/hgobject.c (hg_object_init): initialize the string object.

	* hieroglyph/hgstring.[ch]: new.

	* hieroglyph/hgallocator.c (_hg_allocator_realloc): unlock the object
	when any referrer found.
	(_hg_allocator_alloc): keep a concistency on the behaviour of
	the lock count.
	(_hg_allocator_realloc): likewise.

	* tests/hgallocator.c (test_realloc): don't pop up the unnecessary
	backtrace.

	* tests/hgencoding.c (test_hg_encoding_init): likewise.
	(test_hg_encoding_get_system_encoding_name): likewise.

	* hieroglyph/hgobject.c (hg_object_new): don't invoke
	the initialization function when failing allocating the object.
	(hg_object_new): fail if the initialization fails.

	* hieroglyph/hgallocator.c (_hg_allocator_realloc): not fail
	when lock_count is less than 2. it's still likely when locking
	the object in the object.
	(_hg_allocator_realloc): unlock the object when the lock_count is 2.

2010-06-24  Akira TAGOH  <akira@tagoh.org>

	* hieroglyph/hgreal.h (hg_real_convert_from_native): new.
	(HG_QREAL): new.

	* hieroglyph/hgmem.c (hg_mem_realloc): new.

	* hieroglyph/hgallocator.c (_hg_allocator_bitmap_alloc):
	Fix the unexpected marking issue.
	(_hg_allocator_bitmap_realloc): new.
	(_hg_allocator_bitmap_free): mutex-lock when clearing the bitmaps.
	(_hg_allocator_realloc): new.
	(_hg_allocator_lock_object): mutex-lock to avoid the race-condition
	with realloc.

2010-06-22  Akira TAGOH  <akira@tagoh.org>

	* hieroglyph/hgerror.c (hg_get_stacktrace): trivial fix to get rid of
	the unnecessary trace log.

2010-06-08  Akira TAGOH  <akira@tagoh.org>

	* hieroglyph/hgobject.[ch]: clean up.

	* hieroglyph/hgquark.h (hg_type_is_simple): new.
	(hg_quark_get_value): new.

	* hieroglyph/hgallocator.c: trivial change to keep consistency between
	Qnil and HG_QNULL.

2010-06-05  Akira TAGOH  <akira@tagoh.org>

	Update the header files that provides the simple object to be based on
	hg_quark_t rather than hg_object_t.

	* hieroglyph/hgbool.h (HG_QBOOL): new.

	* hieroglyph/hgint.h (HG_QINT): new.

	* hieroglyph/hgmark.h (HG_QMARK): new.

	* hieroglyph/hgnull.h (HG_QNULL): new.

	* hieroglyph/hgquark.h: add more macros and polish some.

2010-05-29  Akira TAGOH  <akira@tagoh.org>

	* hieroglyph/hgquark.h: new.

2010-05-27  Akira TAGOH  <akira@tagoh.org>

	* tests/hgname.c: add testcases.

	* hieroglyph/hgname.c (_hg_object_name_new): Fix a typo.

	* hieroglyph/hgobject.c (_hg_object_new): add the object type to
	the quark.
	(hg_object_init): add the name object vtable.
	(hg_object_init): initialize the encodings.

	* hieroglyph/hgmem.c (hg_mem_free): get rid of the unnecessary bits.
	(hg_mem_lock_object): likewise.
	(hg_mem_unlock_object): likewise.

	* tests/hgnull.c: add testcases.

	* tests/hgmark.c: add testcases.

	* hieroglyph/hgnull.h (hg_object_null_new): new macro.

	* hieroglyph/hgmark.h (hg_object_mark_new): new macro.

	* tests/hgint.c: add testcases.

	* hieroglyph/hgint.h (hg_object_int_new): new macro.

	* tests/hgbool.c: add testcases.

	* hieroglyph/hgtypes.h (Qnil): correct a typo.

	* hieroglyph/hgbool.h (hg_object_bool_new): new macro.

	* hieroglyph/hgallocator.c (_hg_allocator_initialize_and_lock_object):
	Fix wrong casting.

	* tests/hgencoding.c: add testcases.

	* hieroglyph/hgencoding.c (hg_encoding_lookup_system_encoding): 
	add more sanity check.

	* hieroglyph/hgname.[ch]: new.

	* hieroglyph/hgobject.c (hg_object_new): API change to make this
	comfortable for others.

	* hieroglyph/hgencoding.[ch]: new.

	* hieroglyph/hgtypes.h: add hg_system_encoding_t type.

2010-05-26  Akira TAGOH  <akira@tagoh.org>

	* hieroglyph/hgobject.c (hg_object_new): align the preallocated size.
	(hg_object_init): add missing the object vtables initialization.

2010-05-25  Akira TAGOH  <akira@tagoh.org>

	* hieroglyph/hgobject.h (HG_DEFINE_VTABLE): add new macro.

	* hieroglyph/hgnull.[ch]: new.

	* hieroglyph/hgmark.[ch]: new.

	* hieroglyph/hgbool.[ch]: new.

	* hieroglyph/hgint.[ch]: new.

	* hieroglyph/hgobject.[ch]: new.

	* hieroglyph/hgallocator.c: get rid of the unnecessary error check.

	* hieroglyph/hgallocator-private.h (hg_get_allocated_object):
	new macro.
	(hg_get_allocator_block): new macro.

2010-05-24  Akira TAGOH  <akira@tagoh.org>

	* hieroglyph/hgallocator.c (_hg_allocator_alloc): add ret argument to
	be able to set the real address.
	(_hg_allocator_alloc): don't unlock the object.
	(_hg_allocator_lock_internal_object): new to get
	the hg_allocator_block_t object.

	* hieroglyph/hgtypes.h: extend hg_quark_t to 64bit.

	* hieroglyph/hgmem.c (hg_mem_lock_object, hg_mem_unlock_object):
	add missing functions.

	* hieroglyph/hgerror.h (hg_stacktrace): Output to the glib log
	instead of stderr directly.

	* hieroglyph/hgallocator.c (_hg_allocator_bitmap_alloc): Fix a typo.
	(_hg_allocator_bitmap_free): Fix a typo.
	(_hg_allocator_alloc): Fix a typo.

2010-05-23  Akira TAGOH  <akira@tagoh.org>

	* hieroglyph/hgallocator.c: Drop hg_mem_t dependencies.

	* hieroglyph/hgallocator-private.h: new.

	* hieroglyph/Makefile.am (LIBS): Add missing library.

	* Makefile.am (SUBDIRS): Add tests.

2010-05-21  Akira TAGOH  <akira@tagoh.org>

	* hgallocator.[ch]: Revised.

	* hgerror.[ch]: Revised.

	* hgmacros.h: Revised.

	* hgmem-private.h: Revised.

	* hgmem.[ch]: Revised.

	* hgtypes.h: Revised.

	* hgutils.[ch]: Revised.


